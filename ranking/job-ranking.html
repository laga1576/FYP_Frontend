<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ResumeExpert â€“ Upload</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark-theme">

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="ResumeXpert.png" alt="ResumeXpert Logo" class="logo">
      <span class="brand">ResumeExpert</span>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="upload.html" class="active">Analyzer</a></li>
        <li><a href="ranking/job-ranking.html">Ranking</a></li>
        <li><a href="#">About</a></li>
      </ul>
    </div>
    <div class="nav-right">
      <a href="login system/login.html" class="login-btn">Log In</a>
      <a href="#" class="signup-btn">Sign Up</a>
    </div>
  </nav>


    <div style="margin-bottom: 20px;">
        <button onclick="window.location.href='view-jobs.html'">Back to Jobs</button>
        <button onclick="window.location.href='resumes-ranking.html?jobId=' + jobId">+ Add Resume</button>
    </div>
    <h1>Job Rankings</h1>
    <div id="jobTitle"></div>
    <div id="rankingsList"></div>

    <script>
        // Get job ID from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('jobId');

        if (!jobId) {
            document.body.innerHTML = '<h1>Error: No job ID provided</h1>';
        } else {
            // Fetch rankings data
            fetch(`https://resumexpert-dev.onrender.com/api/jobs/${jobId}/rankings`, {
                credentials: 'include'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Display job title
                    document.getElementById('jobTitle').innerHTML = `<h2>${data.job_title}</h2>`;

                    // Create rankings list
                    const rankingsList = document.getElementById('rankingsList');
                    if (data.rankings.length === 0) {
                        rankingsList.innerHTML = '<p>No rankings available</p>';
                    } else {
                        const rankingsHTML = data.rankings.map((ranking, index) => `
                            <div>
                                <h3>Rank #${index + 1}</h3>
                                <p><strong>Candidate:</strong> ${ranking.candidate_name}</p>
                                <p><strong>Score:</strong> ${ranking.score}</p>
                                <p><strong>Summary:</strong> ${ranking.summary}</p>
                                <p><strong>Resume:</strong> ${ranking.filename}</p>
                                <p><strong>Date:</strong> ${new Date(ranking.created_at).toLocaleString()}</p>
                            </div>
                            <hr>
                        `).join('');
                        rankingsList.innerHTML = rankingsHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.body.innerHTML = '<h1>Error loading rankings</h1>';
                });
        }
    </script>
</body>
</html>
