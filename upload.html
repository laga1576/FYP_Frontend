<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ResumeExpert – Upload</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="dark-theme">

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="ResumeXpert.png" alt="ResumeXpert Logo" class="logo">
      <span class="brand">ResumeExpert</span>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="upload.html">Analyzer</a></li>
        <li><a href="#">Ranking</a></li>
        <li><a href="#">About</a></li>
      </ul>
    </div>
    <div class="nav-right">
      <a href="#" class="login-btn">Log In</a>
      <a href="#" class="signup-btn">Sign Up</a>
    </div>
  </nav>

  <!-- Upload Section -->
  <main class="upload-section">
    <h1 class="section-title">Smart Resume Analyzer</h1>
    <div class="upload-boxes">
      <div class="resume-box">
        <label for="resume">Resume (PDF):</label>
        <div class="drop-box">
          <p>Drop your resume here or choose a file.</p>
          <input type="file" id="resume" accept="application/pdf" />
        </div>
        <div class="file-info-box" id="file-info-box">
        <p id="file-name"></p>
      </div>
        <input type="file" id="resume" accept="application/pdf" style="display: none;" />
        <button class="btn-primary" id="upload-btn">Upload PDF</button>
      </div>

      <div class="job-desc-box">
        <label for="job-description">Job Description:</label>
        <textarea id="job-description" placeholder="Enter job description here..."></textarea>
      </div>
    </div>
    <div class="analyze-button-container">
      <button class="btn-process">Analyze</button>
    </div>
    <div id="analysis-output" class="result-output"></div>
  </main>



  <footer class="footer">
    © ResumeExpert 2025. All rights reserved.
  </footer>

  <script>
  const resumeInput = document.getElementById("resume");
  const jobDescInput = document.getElementById("job-description");
  const analyzeBtn = document.querySelector(".btn-process");
  const fileNameDisplay = document.getElementById("file-name");
  const analysisOutput = document.getElementById("analysis-output");
  const loadingScreen = document.querySelector(".loading-screen");
  const resultScreen = document.querySelector(".result-screen");

  resumeInput.addEventListener("change", function () {
    const file = this.files[0];
    fileNameDisplay.textContent = file ? file.name : "";
  });

  analyzeBtn.addEventListener("click", async function () {
    const file = resumeInput.files[0];
    const jobDesc = jobDescInput.value.trim();

    if (!file) {
      alert("Please select a PDF file.");
      return;
    }

    if (!jobDesc) {
      alert("Please enter a job description.");
      return;
    }

    // Show loading screen
    loadingScreen.style.display = "block";
    resultScreen.style.display = "none";
    analysisOutput.innerHTML = "";

    const formData = new FormData();
    formData.append("file", file);
    formData.append("job_desc", jobDesc);

    try {
      const uploadRes = await fetch("https://resumexpert-dev.onrender.com/upload", {
        method: "POST",
        body: formData
      });

      const uploadData = await uploadRes.json();

      const analyzeRes = await fetch("https://resumexpert-dev.onrender.com/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(uploadData)
      });

      const analysis = await analyzeRes.json();
      const bestMatchTitle = analysis.career_recommendations?.best_match?.title;

      let jobMatchingHTML = "";
      if (bestMatchTitle) {
        const jobMatchRes = await fetch("https://resumexpert-dev.onrender.com/job-matching", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ job_title: bestMatchTitle })
        });

        const jobMatchData = await jobMatchRes.json();
        const applyOptions = jobMatchData.apply_options || [];

        jobMatchingHTML = `
          <div class="result-section">
            <h3>6. Job Application Options for "${bestMatchTitle}"</h3>
            <ul>
              ${applyOptions.map(job => `
                <li>
                  <p><strong>Publisher:</strong> ${job.publisher}</p>
                  <p><strong>Apply Link:</strong> <a href="${job.apply_link}" target="_blank">${job.apply_link}</a></p>
                  <p><strong>Is Direct:</strong> ${job.is_direct ? 'Yes' : 'No'}</p>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }

      analysisOutput.innerHTML = `
        <section class="result-screen" style="display: block;">
          <h2>Analyzed Result</h2>
          <div class="result-container">
            <div class="score-box">
              <h3>Match Score</h3>
              <div class="score-bar">
                <span>${analysis.match_score || 'N/A'}%</span>
                <div class="progress" style="width: ${analysis.match_score || 0}%;"></div>
              </div>
            </div>

            <div class="keyword-box">
              <h4>Missing Keywords</h4>
              ${(analysis.missing_keywords || []).map(kw => `<span class="tag">${kw}</span>`).join('') || 'None'}
            </div>

            <div class="keyword-box">
              <h4>Extra Keywords to Add</h4>
              ${(analysis.extra_keywords_to_add || []).map(kw => `<span class="tag">${kw}</span>`).join('') || 'None'}
            </div>

            <div class="suggestions-box">
              <h4>Suggested Improvements</h4>
              ${(analysis.suggested_improvements || []).map(s => `
                <p><strong>Issue:</strong> ${s.issue}</p>
                <p><strong>Suggestion:</strong> ${s.suggestion}</p>
              `).join('') || 'None'}
            </div>

            <div class="careers-box">
              <h4>Career Recommendations</h4>
              <p><strong>Best Match:</strong> ${bestMatchTitle || 'N/A'}</p>
              <p><strong>Reason:</strong> ${analysis.career_recommendations?.best_match?.reason || 'N/A'}</p>

              <p><strong>Other Careers:</strong></p>
              <ul>
                ${(analysis.career_recommendations?.other_careers || []).map(c => `
                  <li>${c.title} – ${c.reason}</li>
                `).join('') || '<li>None</li>'}
              </ul>
            </div>

            ${jobMatchingHTML}

            <div class="job-listings-button-container">
              <button class="btn-gradient" onclick="document.querySelector('.job-listings-screen').style.display = 'block';">View Job Listings</button>
            </div>
          </div>
        </section>
      `;

    } catch (err) {
      analysisOutput.innerHTML = `<div class="card error">Error: ${err.message}</div>`;
    } finally {
      loadingScreen.style.display = "none";
    }
  });
</script>



</body>
</html>
